_mode=host
pkgname=squeekboard
pkgdesc="The phosh keyboard"
pkgver=1.16.0.r0.gd49ce45
pkgrel=1
_arches=all
arch=(
    x86_64
    aarch64
)
license=(GPL)
url=https://gitlab.gnome.org/World/Phosh/squeekboard
depends=(
    gtk3
    gnome-desktop
    feedbackd
    wayland-protocols
)
makedepends=(
    rust
    cargo
    meson
    ninja
)
_commit=d49ce45de0956432cef9b957f806d9377fee4bc0
source=("git+$url#commit=$_commit")
sha256sums=(SKIP)

pkgver() {
    cd "$pkgname"
    git describe --long "$_commit" | sed 's/^v//;s/\([^-]*-g\)/r\1/;s/-/./g'
}

prepare() {
    cd ${pkgname}
}

build() {
    arch-meson ${pkgname} output -Dtests=false
    ninja -C output
}

package() {
    DESTDIR="$pkgdir" ninja -C output install
    ln -sf /usr/bin/squeekboard "$pkgdir/usr/bin/osk-wayland"
}
