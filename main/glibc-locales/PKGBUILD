_mode=cross
pkgname=glibc-locales
pkgver=2.32
pkgrel=4
_arches=specific
arch=(any)
license=(GPL3)
depends=("glibc=$pkgver")
install=glibc-locales.install
source=(
    60-glibc-locales.hook
    locale-gen.hook
    locale-gen
    Makefile
)
sha256sums=(
    614416c7ee15dd6f28ce2553f5950546e116c9ea5389df4485f580457379f1c0
    1e9a564dbbccba0eca7917396d00aef46e6b6cf31972a34bf7e620dc84156e03
    371fbec2b57cb85005eb28df233d0689a71b999127b5c7c40f3fdf978c5909a9
    8c8598374b5b00a4aab1a4939cb2ef30a3a3c5c3ddc35766bfbd6ccb619c58ab
)

package() {
    mkdir -p $srcdir/$pkgver
    cd $srcdir/$pkgver
    make -f ../Makefile $(ls /usr/share/i18n/locales/* | xargs -n 1 basename | sed 's|$|.utf8/LC_NAME|')

    install -Dm755 "$srcdir/locale-gen" "$pkgdir/usr/lib/glibc-locale/locale-gen"
    mkdir -p $pkgdir/usr/lib/glibc-locale/
    cp -r $srcdir/$pkgver/* $pkgdir/usr/lib/glibc-locale/
    for file in $pkgdir/usr/lib/glibc-locale/*@*.utf8; do
        mv "$file" "$(echo "$file" | cut -d "@" -f 1).utf8@$(echo "$file" | cut -d "@" -f 2 | cut -d "." -f 1)"
    done
    install -Dm644 "$srcdir/60-glibc-locales.hook" "$pkgdir/usr/share/libalpm/hooks/60-glibc-locales.hook"
    install -Dm644 "$srcdir/locale-gen.hook" "$pkgdir/usr/share/libalpm/hooks/locale-gen.hook"
}
