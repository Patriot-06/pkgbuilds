_mode=cross
pkgbase=boot-lk2nd-git
pkgname=(
    boot-lk2nd-msm8916-git
    boot-lk2nd-msm8974-git
    boot-lk2nd-msm8226-git
)
pkgver=r5737.a706d268
pkgrel=1
_arches=specific
arch=(aarch64)
license=(MIT)
url=https://github.com/msm8916-mainline/lk2nd
provides=(boot-lk2nd)
makedepends=(
    python
    dtc
    arm-none-eabi-gcc
)
_commit=a706d2680e26646e22cf605a09a6293261a9c650
source=("git+$url#commit=$_commit")
sha256sums=(SKIP)

pkgver() {
    cd "$srcdir"/lk2nd
    printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

build() {
    cd "$srcdir"/lk2nd
    rm -rf build-msm8916-secondary build-msm8974-secondary build-msm8226-secondary
    make TOOLCHAIN_PREFIX=arm-none-eabi- msm8916-secondary
    make TOOLCHAIN_PREFIX=arm-none-eabi- msm8974-secondary
    make TOOLCHAIN_PREFIX=arm-none-eabi- msm8226-secondary
}

package_boot-lk2nd-msm8916-git() {
    provides+=(lk2nd-msm8916)
    install -Dm644 "$srcdir"/lk2nd/build-msm8916-secondary/lk2nd.img "${pkgdir}/boot/lk2nd.img"
    install -Dm644 "$srcdir"/lk2nd/build-msm8916-secondary/lk2nd-appended-dtb.img "${pkgdir}/boot/lk2nd-appended-dtb.img"
}

package_boot-lk2nd-msm8974-git() {
    provides+=(lk2nd-msm8974)
    install -Dm644 "$srcdir"/lk2nd/build-msm8974-secondary/lk2nd.img "${pkgdir}/boot/lk2nd.img"
    #install -Dm644 "$srcdir"/lk2nd/build-msm8974-secondary/lk2nd-appended-dtb.img "${pkgdir}/boot/lk2nd-appended-dtb.img"
}

package_boot-lk2nd-msm8226-git() {
    provides+=(lk2nd-msm8226)
    #install -Dm644 "$srcdir"/lk2nd/build-msm8226-secondary/lk2nd.img "${pkgdir}/boot/lk2nd.img"
    install -Dm644 "$srcdir"/lk2nd/build-msm8226-secondary/lk2nd-appended-dtb.img "${pkgdir}/boot/lk2nd-appended-dtb.img"
}
