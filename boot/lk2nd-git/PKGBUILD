_mode=cross
pkgbase=boot-lk2nd-git
pkgname=(
    boot-lk2nd-msm8916-git
    boot-lk2nd-msm8974-git
    boot-lk2nd-msm8226-git
    boot-lk2nd-msm8917-git
    boot-lk2nd-msm8937-git
    boot-lk2nd-land-git
    boot-lk2nd-msm8940-git
    boot-lk2nd-msm8953-git
)
pkgver=r0.5a728545
pkgrel=1
_arches=specific
arch=(
        aarch64
        armv7
)
license=(MIT)
provides=(boot-lk2nd)
makedepends=(
    python
    dtc
    arm-none-eabi-gcc
)
_commit=5a72bd3baa26ccedfd2562c1ba1e396155388d9a # msm8916
_commit8953=85452785764bd268f534d51e022ed177b6b30b74
source=(
    "lk2nd-msm8916.tar.gz::https://github.com/msm8916-mainline/lk2nd/archive/${_commit}.tar.gz"
    "lk2nd-msm8953.tar.gz::https://github.com/msm8953-mainline/lk2nd/archive/${_commit8953}.tar.gz"
    working-land.patch # some enhancements to lk2nd and support for few msm8917/37/40 devices, including land, santoni
)
sha256sums=(
    4ec8ba049a7d304f5ccf9a48d142412de0f55c5e34e8512cdf51ac436b5f7518
    b569e42611d0931a82fcfc32b7dde1418e07e9a86267394ae7c873f9833cd849
    21b3da06cd4e56a58bfb32ea4cf1d533f1300878545157be5469c50f8746a1f9
)

pkgver() {
    printf "r0.%s" "${_commit:0:4}${_commit8953:0:4}"
}

prepare() {
    cd "$srcdir/lk2nd-${_commit8953}"
    patch -f -p 1  < ../working-land.patch || true
}

build() {
    cd "$srcdir/lk2nd-${_commit}"
    make spotless
    make TOOLCHAIN_PREFIX=arm-none-eabi- lk2nd-msm8916
    make TOOLCHAIN_PREFIX=arm-none-eabi- lk2nd-msm8974
    make TOOLCHAIN_PREFIX=arm-none-eabi- lk2nd-msm8226

    cd "$srcdir/lk2nd-${_commit8953}"
    make spotless
    make TOOLCHAIN_PREFIX=arm-none-eabi- msm8917-secondary
    make TOOLCHAIN_PREFIX=arm-none-eabi- msm8937-secondary
    make TOOLCHAIN_PREFIX=arm-none-eabi- land-secondary
    make TOOLCHAIN_PREFIX=arm-none-eabi- msm8952-secondary
    make TOOLCHAIN_PREFIX=arm-none-eabi- msm8953-secondary

}

package_boot-lk2nd-msm8916-git() {
    provides+=(lk2nd-msm8916)
    install -Dm644 "$srcdir/lk2nd-${_commit}/build-lk2nd-msm8916/lk2nd.img" "${pkgdir}/boot/lk2nd.img"
}

package_boot-lk2nd-msm8974-git() {
    provides+=(lk2nd-msm8974)
    install -Dm644 "$srcdir/lk2nd-${_commit}/build-lk2nd-msm8974/lk2nd.img" "${pkgdir}/boot/lk2nd.img"
}

package_boot-lk2nd-msm8226-git() {
    provides+=(lk2nd-msm8226)
    install -Dm644 "$srcdir/lk2nd-${_commit}/build-lk2nd-msm8226/lk2nd.img" "${pkgdir}/boot/lk2nd.img"
}

package_boot-lk2nd-msm8917-git() {
    provides+=(lk2nd-msm8917)
    install -Dm644 "$srcdir/lk2nd-${_commit8953}/build-msm8917-secondary/lk2nd.img" "${pkgdir}/boot/lk2nd.img"
}

package_boot-lk2nd-msm8937-git() {
    provides+=(lk2nd-msm8937)
    install -Dm644 "$srcdir/lk2nd-${_commit8953}/build-msm8937-secondary/lk2nd.img" "${pkgdir}/boot/lk2nd.img"
}

package_boot-lk2nd-land-git() {
    provides+=(boot-lk2nd-land-git)
    install -Dm644 "$srcdir/lk2nd-${_commit8953}/build-land-secondary/lk2nd.img" "${pkgdir}/boot/lk2nd.img"
}


package_boot-lk2nd-msm8940-git() {
    provides+=(lk2nd-msm8940)
    install -Dm644 "$srcdir/lk2nd-${_commit8953}/build-msm8952-secondary/lk2nd.img" "${pkgdir}/boot/lk2nd.img"
}

package_boot-lk2nd-msm8953-git() {
    provides+=(lk2nd-msm8953)
    install -Dm644 "$srcdir/lk2nd-${_commit8953}/build-msm8953-secondary/lk2nd.img" "${pkgdir}/boot/lk2nd.img"
}
